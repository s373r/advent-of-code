#[cfg(test)]
mod tests {
    const WIDTH: usize = 101;
    const HEIGHT: usize = 103;

    fn build_map(input: &str, seconds: usize) -> [[char; WIDTH]; HEIGHT] {
        use regex::Regex;

        let mut map = [['.'; WIDTH]; HEIGHT];
        let re = Regex::new(r"-?\d+").unwrap();

        let robots_it = input.lines().map(|line| {
            let mut matches_it = re
                .find_iter(line)
                .map(|m| m.as_str().parse::<i32>().unwrap());

            let x = matches_it.next().unwrap();
            let y = matches_it.next().unwrap();

            let dx = matches_it.next().unwrap();
            let dy = matches_it.next().unwrap();

            ((x, y), (dx, dy))
        });

        for ((x, y), (dx, dy)) in robots_it {
            let new_x = (x + dx * seconds as i32).rem_euclid(WIDTH as i32) as usize;
            let new_y = (y + dy * seconds as i32).rem_euclid(HEIGHT as i32) as usize;

            map[new_y][new_x] = 'x';
        }

        map
    }

    fn solution(input: &str) -> usize {
        for seconds in 0.. {
            let map = build_map(input, seconds);

            // TODO: Uncomment to see the tree
            // println!("--- {seconds} ---");
            // for row in map {
            //     for x in row {
            //         print!("{x}");
            //     }
            //     println!();
            // }

            let search_pattern = &[
                'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x', 'x',
                'x', 'x', 'x', 'x', 'x',
            ];

            // Substring search without allocations
            let have_found = map.into_iter().any(|row| {
                row.windows(search_pattern.len())
                    .any(|window| window == search_pattern)
            });

            if have_found {
                return seconds;
            }
        }

        unreachable!()
    }

    #[test]
    fn test_input() {
        let input = std::fs::read_to_string("input.txt").unwrap();

        assert_eq!(6752, solution(&input));

        // --- 6752 ---
        // ................................x...............................................................x....
        // .......................................................x...............x.................x.....x.....
        // .x.........................................................................................x.........
        // ..........................................................................x..........................
        // ..............................................................x......................................
        // ...............................x......x........................x.....................................
        // .................x....................x.........................................x....................
        // .......................x.............................................................................
        // ................x..................x........................x........................................
        // ......x..............................................................................x...............
        // ............................................................................x........................
        // .................................................................................................x...
        // ..................x....................xx................................x...........................
        // ...............x...........................................x...................x.....................
        // ....................................................................................................x
        // ....................x................................................................................
        // .............................................................x.......................................
        // .....................................................................................................
        // ......................................x............................x.................................
        // ................................................x....................................................
        // .................................................................x..........x........x...........x...
        // ..............................................x......................................................
        // .....................................................................................................
        // ..x......................................x.....................x.............x.......................
        // .....................................................................................................
        // ....x..............................x...............x....x............................................
        // .............................................x...........x...........................................
        // ..............................................................................................x......
        // ..............................................................x.....x................................
        // .......x.............................................................................................
        // .....................................................................................................
        // ...............x.....................................................................................
        // ..................................x..........x.......................................................
        // ...........................................................x.........................................
        // ...................................................................x.................................
        // ................................................................................x....................
        // ...................................................................................................x.
        // .............................................xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.........................
        // .............................................x.............................x.........................
        // .............................................x.............................x..x......................
        // .............................................x.............................x........................x
        // ........................x....................x.............................x.........................
        // .......x....x.......x...x....................x..............x..............x....x....................
        // x............................................x.............xxx.............x....................x....
        // .....................x.......x...............x............xxxxx............x.........................
        // .......x.....................................x...........xxxxxxx...........x.........................
        // ................x...................x........x..........xxxxxxxxx..........x.........................
        // .............................................x............xxxxx............x.......................x.
        // .............................................x...........xxxxxxx...........x.........................
        // .............................................x..........xxxxxxxxx..........x...................x.....
        // ...............x.............................x.........xxxxxxxxxxx.........x.........................
        // .......x.....................................x........xxxxxxxxxxxxx........x..............x..........
        // .............................................x..........xxxxxxxxx..........x....x....................
        // ..x...................x.............x........x.........xxxxxxxxxxx.........x.........................
        // ....x........................................x........xxxxxxxxxxxxx........x.........................
        // .............................................x.......xxxxxxxxxxxxxxx.......x.........................
        // .............................................x......xxxxxxxxxxxxxxxxx......x.........................
        // .............................................x........xxxxxxxxxxxxx........x.........................
        // ...................x................x........x.......xxxxxxxxxxxxxxx.......x....x....................
        // .............................................x......xxxxxxxxxxxxxxxxx......x....................x....
        // ...x.........................................x.....xxxxxxxxxxxxxxxxxxx.....x.........................
        // .............................................x....xxxxxxxxxxxxxxxxxxxxx....x....x....................
        // .....x.......................................x.............xxx.............x.........................
        // .............................................x.............xxx.............x.........................
        // .............................................x.............xxx.............x.........................
        // .............................................x.............................x.........................
        // .............................................x.............................x.........................
        // ....................x........................x.............................x.........................
        // ....................x....x..........x........x.............................x.x.......................
        // ...................x.........................xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.........x...............
        // .....................................................................................................
        // ....x.....................................x.............................x............................
        // .......................................x.............................................................
        // ......................................x.......................x......................................
        // ....................................................................................x................
        // ...............x.....................................................................................
        // .................................................................................................x...
        // ..................................................................................x..................
        // .....................................................................................................
        // .....................................................................................................
        // .....................................................................................................
        // .............................................x.....x.................................................
        // ...................................................................x........x.....x..................
        // .........x..................................x..x.................x...................................
        // ......x.................................x...........................x................................
        // ........................................................................x.........................x..
        // .....................................................................................................
        // ................................x........................x...........................................
        // .................................................................x..........x........................
        // .................x..............x...................x................................................
        // .....................................................................................................
        // .....................................................................................................
        // .....................................................................................................
        // ..................................................................x.................x................
        // .....................................................................................................
        // .............................................x.......................................................
        // .....................................................x........................x......................
        // ..............x......................................................................................
        // ..............................x........................x...........................x.................
        // .........................x...........................................................................
        // .....................................................................................................
        // .........................................................................................x...........
        // ...................................................................x...xx............................
    }
}
